<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Vibe</title>
    <style>
        /* Import Lora (texte) et Bodoni Moda (titres) */
        @import url('https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@400;500;600;700&family=Lora:wght@400;500;600&display=swap');

        /* Palette Aux Délices de Sèvres - Lavande Pastel */
        :root {
            --primary: #4a3a4e;
            --accent: #b8a5bc;
            --secondary: #8b7091;
            --light: #f5f0f6;
            --white: #fefcff;
            --gradient-start: #d4c5d8;
            --gradient-end: #b8a5bc;
            --text: #4a3a4e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            width: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Lora', 'Bodoni Moda', 'Times New Roman', serif;
            background-color: var(--white);
            color: var(--text);
            line-height: 1.8;
        }

        /* ============================================
           STRUCTURE DE BASE (MOBILE-FIRST) - 1 COLONNE
           ============================================ */

        .wrapper {
            width: 100%;
            max-width: 1500px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .info-column,
        .notes-column,
        .notes-section-bottom {
            width: 100%;
            position: static;
        }

        .chat-container {
            width: 100%;
            position: static;
        }

        .notes-section-bottom {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* ============================================
           STYLES DES COMPOSANTS
           ============================================ */

        .chat-column {
            display: flex;
            flex-direction: column;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(74, 58, 78, 0.08);
            overflow: visible;
            border: 1px solid rgba(184, 165, 188, 0.15);
        }

        .notes-textarea {
            width: 100%;
            height: 200px;
            padding: 12px 14px;
            border: 2px solid rgba(139, 112, 145, 0.2);
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Lora', serif;
            background-color: var(--white);
            resize: vertical;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(184, 165, 188, 0.12);
        }

        .header {
            background-color: var(--primary);
            color: var(--white);
            padding: 24px 28px;
            text-align: center;
            border-bottom: 2px solid var(--accent);
            flex-shrink: 0;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        .header h1 {
            font-size: 26px;
            font-weight: 400;
            letter-spacing: 2px;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-family: 'Bodoni Moda', 'Lora', serif;
        }

        .subtitle {
            font-size: 13px;
            font-weight: 400;
            opacity: 0.92;
            letter-spacing: 0.5px;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        .header-actions {
            display: none;
        }

        .name-input-section {
            padding: 18px 24px;
            background: linear-gradient(135deg, rgba(212, 197, 216, 0.12), rgba(184, 165, 188, 0.08));
            border-bottom: 1px solid rgba(184, 165, 188, 0.2);
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .name-input {
            flex: 1;
            padding: 14px 18px;
            border: 2px solid rgba(139, 112, 145, 0.3);
            border-radius: 10px;
            font-size: 15px;
            font-family: 'Lora', serif;
            transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
            background-color: var(--white);
        }

        .name-input:focus {
            outline: none;
            border-color: var(--accent);
            background-color: var(--white);
            box-shadow: 0 0 0 4px rgba(184, 165, 188, 0.15);
        }

        .name-input::placeholder {
            color: var(--secondary);
            font-weight: 400;
            font-style: italic;
        }

        .validate-name-btn {
            padding: 14px 24px;
            background: var(--accent);
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, opacity 0.3s, background-color 0.3s;
            white-space: nowrap;
            letter-spacing: 0.5px;
        }

        .validate-name-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(184, 165, 188, 0.25);
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
        }

        .validate-name-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .info-card {
            background: linear-gradient(180deg, var(--white), var(--light));
            border-left: 3px solid var(--accent);
            padding: 20px 22px;
            border-radius: 12px;
            box-shadow: 0 3px 12px rgba(74, 58, 78, 0.06);
            font-size: 13px;
            color: var(--text);
        }

        .info-column {
            display: flex;
            flex-direction: column;
        }

        .notes-section,
        .disclaimer-section {
            width: 100%;
        }

        .info-card-logo {
            height: 130px;
            width: auto;
            margin-bottom: 20px;
            display: block;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(74, 58, 78, 0.08);
        }

        .info-card h3 {
            margin: 0 0 12px 0;
            font-size: 17px;
            color: var(--primary);
            font-weight: 500;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .info-card ul {
            margin: 8px 0 0 20px;
            padding: 0;
            font-size: 12px;
            line-height: 1.8;
        }

        .info-card p {
            margin: 8px 0;
            font-size: 12px;
            line-height: 1.8;
        }

        .info-card strong {
            color: var(--secondary);
            font-weight: 600;
        }

        .chat-box {
            overflow-y: auto;
            padding: 28px;
            display: flex;
            flex-direction: column;
            gap: 18px;
            background: var(--white);
            min-height: 300px;
        }

        .chat-box::-webkit-scrollbar {
            width: 8px;
        }

        .chat-box::-webkit-scrollbar-track {
            background: var(--light);
        }

        .chat-box::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        .chat-box::-webkit-scrollbar-thumb:hover {
            background: var(--secondary);
        }

        .message {
            display: flex;
            animation: slideIn 0.35s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: none;
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.ai {
            justify-content: flex-start;
        }

        .bubble {
            max-width: 80%;
            padding: 16px 22px;
            border-radius: 18px;
            word-wrap: break-word;
            font-size: 15px;
            line-height: 1.7;
            font-weight: 400;
        }

        .message.user .bubble {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: var(--white);
            border-bottom-right-radius: 6px;
            box-shadow: 0 3px 12px rgba(184, 165, 188, 0.18);
        }

        .message.ai .bubble {
            background: var(--light);
            color: var(--primary);
            border-bottom-left-radius: 6px;
            box-shadow: 0 3px 12px rgba(74, 58, 78, 0.06);
            border: 1px solid rgba(139, 112, 145, 0.12);
        }

        .typing-indicator {
            display: flex;
            gap: 8px;
            align-items: center;
            padding: 14px 20px;
            background: var(--light);
            border-radius: 18px;
            width: fit-content;
            border: 1px solid rgba(139, 112, 145, 0.12);
        }

        .dot-flashing {
            position: relative;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--accent);
            animation: dotFlashing 1s infinite linear alternate;
        }

        .dot-flashing::before,
        .dot-flashing::after {
            content: '';
            position: absolute;
            top: 0;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--accent);
        }

        .dot-flashing::before {
            left: -12px;
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 0s;
        }

        .dot-flashing::after {
            left: 12px;
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 1s;
        }

        @keyframes dotFlashing {
            0% {
                background-color: var(--accent);
            }

            50%,
            100% {
                background-color: rgba(184, 165, 188, 0.3);
            }
        }

        .input-area-wrapper {
            padding: 0;
            background: var(--white);
            border-top: 1px solid rgba(139, 112, 145, 0.15);
        }

        .input-area {
            display: flex;
            gap: 12px;
            padding: 16px 20px;
        }

        .disclaimer-text {
            font-size: 11px;
            color: var(--secondary);
            padding: 0 20px;
            margin-top: 12px;
            font-style: italic;
            text-align: center;
            line-height: 1.6;
        }

        #messageInput {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid rgba(139, 112, 145, 0.2);
            border-radius: 10px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.3s, box-shadow 0.3s, opacity 0.3s;
            font-family: 'Lora', serif;
            background-color: var(--white);
            min-width: 0;
        }

        #messageInput:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(184, 165, 188, 0.12);
        }

        #messageInput:disabled {
            background-color: rgba(139, 112, 145, 0.05);
            cursor: not-allowed;
            opacity: 0.6;
        }

        #messageInput::placeholder {
            color: var(--secondary);
            font-style: italic;
        }

        #sendBtn {
            padding: 14px 28px;
            background: var(--accent);
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, opacity 0.3s, background 0.3s;
            letter-spacing: 0.5px;
        }

        #sendBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(184, 165, 188, 0.25);
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
        }

        #sendBtn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* --- Calendrier --- */
        #calendar-container {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 12px rgba(74, 58, 78, 0.06);
            border: 1px solid rgba(184, 165, 188, 0.15);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-month-year {
            font-weight: normal;
            font-size: 1em;
            color: var(--primary);
        }

        .calendar-nav {
            background: var(--accent);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .calendar-nav:hover:not(:disabled) {
            background: var(--secondary);
        }

        .calendar-nav:disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
        }

        .calendar-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .calendar-table th {
            padding: 8px;
            text-align: center;
            font-weight: normal;
            color: var(--primary);
            border-bottom: 2px solid var(--light);
            font-size: 1em;
        }

        .calendar-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid var(--light);
            color: var(--primary);
            font-size: 1em;
        }

        .calendar-table td:empty {
            border: none;
        }

        .calendar-table td.monday {
            background-color: var(--light);
        }

        .calendar-table td.highlighted {
            position: relative;
        }

        .calendar-table td.highlighted::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 32px;
            height: 32px;
            border: 2px solid var(--accent);
            border-radius: 50%;
        }

        .sidebar-left {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        #debugPanel {
            display: none;
        }

        .debug-toggle {
            display: none;
        }

        /* ============================================
           RESPONSIVE - GRILLE POUR DESKTOP
           ============================================ */

        @media (min-width: 1024px) {
            .wrapper {
                display: grid;
                grid-template-columns: 300px 1fr 300px;
                grid-template-rows: auto auto auto;
                align-items: start;
                column-gap: 24px;
                row-gap: 16px;
            }

            .sidebar-left {
                grid-column: 1;
                grid-row: 1 / 4;
                position: sticky;
                top: 20px;
                align-self: start;
                max-height: calc(100vh - 40px);
                overflow-y: auto;
            }

            .chat-container {
                grid-column: 2;
                grid-row: 1;
            }

            .chat-column {
                position: sticky;
                top: 0;
                z-index: 100;
            }

            .header {
                border-top-left-radius: 12px;
                border-top-right-radius: 12px;
            }

            .notes-section {
                grid-column: 2;
                grid-row: 2;
                position: static;
                align-self: start;
                justify-self: stretch;
            }

            .disclaimer-section {
                grid-column: 2;
                grid-row: 3;
            }

            .notes-column {
                grid-column: 3;
                grid-row: 1 / 4;
                position: sticky;
                top: 20px;
                align-self: start;
                max-height: calc(100vh - 40px);
                overflow-y: auto;
            }
        }
    </style>
    <link rel="stylesheet" href="examModal.css">
</head>

<body>
    <div class="wrapper">
        <!-- 1. Le chat -->
        <div class="chat-container">
            <div class="chat-column">
                <div class="header">
                    <div class="header-main">
                        <h1 id="chatbotTitle" data-client-name-display="true"><span class="brand-main">Aux
                                Délices</span> <span class="brand-sub">de Sèvres</span></h1>
                        <p class="subtitle">Vous êtes pâtissier/pâtissière. Capucine souhaite passer une
                            commande.<br>
                            Veuillez lire attentivement les consignes avant de commencer l’exercice.</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button id="debugToggle" class="debug-toggle" aria-pressed="false">Afficher le panneau de
                        débogage</button>
                </div>
                <div class="name-input-section">
                    <input type="text" id="clientNameInput" class="name-input" placeholder="Votre nom"
                        autocomplete="off">
                    <button id="validateNameBtn" class="validate-name-btn" disabled>Valider</button>
                </div>
                <div class="chat-box" id="chatBox">
                    <!-- Les messages s'affichent ici -->
                </div>
                <div class="input-area-wrapper">
                    <div class="input-area">
                        <input type="text" id="messageInput" placeholder="Validez votre nom pour écrire..."
                            autocomplete="off" disabled>
                        <button id="sendBtn" disabled>Envoyer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. Les notes -->
        <div class="notes-section">
            <div class="info-card">
                <h3>Notes</h3>
                <textarea id="notesTextarea" class="notes-textarea" placeholder="Saisissez vos notes ici..."></textarea>
            </div>
        </div>

        <!-- Colonne de Gauche (Informations + Calendrier) -->
        <div class="sidebar-left">
            <!-- 3. Informations -->
            <div class="info-column">
                <div class="info-card">
                    <img src="Aux Délices de Sèvres.png" alt="Logo Aux Délices de Sèvres" class="info-card-logo">
                    <h3>Informations</h3>
                    <p><strong>Adresse :</strong> 28 Grande Rue, 92310 Sèvres</p>
                    <p><strong>Horaires :</strong></p>
                    <ul>
                        <li>Lundi : Fermé</li>
                        <li>Mardi - Vendredi : 8h00 – 19h00</li>
                        <li>Samedi : 8h30 – 18h00</li>
                        <li>Dimanche : 8h30 – 13h00</li>
                    </ul>
                    <p><strong>Livraison :</strong></p>
                    <ul>
                        <li>Communes couvertes : Sèvres, Meudon, Chaville, Boulogne-Billancourt, Saint-Cloud,
                            Ville-d'Avray</li>
                        <li>Jours : Du Mardi au Dimanche matin</li>
                        <li>Gratuit dès 80€ d'achat, sinon 12€
                    </ul>
                </div>
            </div>

            <!-- 4. Calendrier -->
            <div id="calendar-container" class="info-card"></div>
        </div>

        <!-- 5. Consignes -->
        <div class="notes-column">
            <div class="info-card">
                <h3>Consignes</h3>
                <div class="instructions">
                    <p>Ce chatbot vous aide à prendre une commande (produits, budget, options de livraison…).</p>
                    <p>Vous avez accès aux informations concernant les horaires, les modalités de livraison et l’adresse
                        de votre pâtisserie.</p>
                    <p> La date d'aujourd'hui est entourée sur le calendrier</p>
                    <p><strong>1.</strong> Posez des questions précises pour obtenir des réponses pertinentes.</p>
                    <p><strong>2.</strong> Vous pouvez prendre des notes tout au long de l’échange ; elles seront
                        disponibles dans le correctif.</p>
                    <p><strong>3.</strong> Une fois toutes les informations réunies, rédigez <strong>un seul
                            message</strong> récapitulatif avec votre proposition pour le client.</p>
                    <p><strong>4.</strong> Terminez ce message en proposant l’envoi d’un devis : <strong>la simple
                            mention du devis déclenche la correction</strong>.</p>
                    <p><strong>Exemple de message final du pâtissier :</strong></p>
                    <p><em>Très bien, je récapitule : vous souhaitez un entremets pour un baptême prévu le 22 mars, avec
                            un retrait l’après-midi entre 15h et 17h.<br>Aucune allergie signalée.<br>Composition :
                            fruits rouges – vanille – citron, pour 12 parts, avec une décoration florale.<br>Budget
                            maximum :
                            250 €.<br>Si cela vous convient, je peux vous préparer un devis.</em></p>
                </div>
            </div>
        </div>

        <!-- 6. Texte libre -->
        <div class="disclaimer-section">
            <p class="disclaimer-text">Votre nom n’est utilisé que pour personnaliser votre expérience. L’IA n’a accès
                ni à votre nom ni à vos notes. L’EISF conserve les informations recueillies et vos échanges peuvent être
                réutilisés, après anonymisation, pour entraîner des systèmes d’intelligence artificielle, sans donnée
                identifiable.</p>
        </div>

    </div>

    <!-- Panneau de debug (toggle) -->
    <div id="debugPanel" class="debug-panel" hidden>
        <div style="display:flex;justify-content:space-between;align-items:center">
        </div>
        <button id="copyPayloadBtn" class="debug-toggle">Copier dernier payload</button>
    </div>
    </div>

<script>
        /**
         * Affiche un calendrier pour un mois et une année donnés.
         * @param {Date} date La date indiquant le mois et l'année à afficher.
         */
        let currentCalendarDate = new Date(2025, 11, 1); // Décembre 2025

        function renderCalendar(date) {
            const calendarContainer = document.getElementById('calendar-container');
            if (!calendarContainer) {
                console.error("L'élément #calendar-container est introuvable.");
                return;
            }

            const year = date.getFullYear();
            const month = date.getMonth(); // 0-11

            const monthNames = ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"];
            const dayNames = ["Lu", "Ma", "Me", "Je", "Ve", "Sa", "Di"]; // Semaine commence lundi

            const firstDayOfMonth = new Date(year, month, 1);
            const lastDayOfMonth = new Date(year, month + 1, 0);
            let firstDayOfWeek = firstDayOfMonth.getDay(); // 0=Dimanche, 1=Lundi...

            // Ajuster pour que la semaine commence le lundi (0=lundi, 6=dimanche)
            firstDayOfWeek = (firstDayOfWeek === 0) ? 6 : firstDayOfWeek - 1;

            const totalDays = lastDayOfMonth.getDate();

            // Vérifier si on peut naviguer (décembre 2025 à novembre 2026)
            const minDate = new Date(2025, 11, 1); // Décembre 2025
            const maxDate = new Date(2026, 10, 30); // Novembre 2026
            const canGoPrev = date > minDate;
            const canGoNext = date < maxDate;

            // Le HTML est généré
            let html = `
                <h3>Calendrier</h3>
                <div class="calendar-header">
                    <button class="calendar-nav" id="prevMonth" ${!canGoPrev ? 'disabled' : ''}>◄</button>
                    <span class="calendar-month-year">${monthNames[month]} ${year}</span>
                    <button class="calendar-nav" id="nextMonth" ${!canGoNext ? 'disabled' : ''}>►</button>
                </div>
                <table class="calendar-table">
                    <thead>
                        <tr>${dayNames.map(day => `<th>${day}</th>`).join('')}</tr>
                    </thead>
                    <tbody>
            `;

            let day = 1;
            for (let i = 0; i < 6; i++) { // 6 lignes max pour un mois
                html += '<tr>';
                for (let j = 0; j < 7; j++) {
                    if ((i === 0 && j < firstDayOfWeek) || day > totalDays) {
                        html += '<td></td>';
                    } else {
                        // Classes spéciales
                        let classes = [];

                        // Colonne lundi (j === 0) plus foncée
                        if (j === 0) {
                            classes.push('monday');
                        }

                        // Cercle beige foncé autour du 5 décembre 2025
                        if (year === 2025 && month === 11 && day === 5) {
                            classes.push('highlighted');
                        }

                        const classAttr = classes.length > 0 ? ` class="${classes.join(' ')}"` : '';
                        html += `<td${classAttr}>${day}</td>`;
                        day++;
                    }
                }
                html += '</tr>';
                if (day > totalDays) break; // Sortir si tous les jours sont placés
            }

            html += '</tbody></table>';
            calendarContainer.innerHTML = html;

            // Ajouter les événements de navigation
            const prevBtn = document.getElementById('prevMonth');
            const nextBtn = document.getElementById('nextMonth');

            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
                    renderCalendar(currentCalendarDate);
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
                    renderCalendar(currentCalendarDate);
                });
            }
        }

        // Initialiser le calendrier au chargement
        document.addEventListener('DOMContentLoaded', () => {
            renderCalendar(currentCalendarDate);
        });
</script>

<script src="script.js"></script>
<script src="chatExamController.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    examController.init();
  });
</script>
    
</body>

</html>
